#include "states.h"

///////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////// State ///////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////

void State::enter(StateIndex previousState) {}

void State::exit(State *nextState) {}

void State::checkIfElementPressed(m5::touch_detail_t clickDetails) {}

StateIndex State::update() { return StateIndex::Same; }

///////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////// State Popup ////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////

StatePopup::StatePopup()
{
}

void StatePopup::enter(StateIndex previousState)
{
    this->previousState = previousState;
}

///////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////// State Menu ////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////

StateMenu::StateMenu()
    : buttonPrevious(15, 185, 130, 40, "Previous"),
      buttonNext(170, 185, 130, 40, "Next")
{
}

void StateMenu::enter(StateIndex previousState)
{
    this->index = StateIndex::Same;
    buttonPrevious.reset();
    buttonNext.reset();

    buttonPrevious.draw();
    buttonNext.draw();
}

void StateMenu::exit(State *nextState)
{
    buttonPrevious.reset();
    buttonNext.reset();
    // TODO pass things to next state if needed
}

StateIndex StateMenu::update()
{
    // if the index has change it means the state must change
    if (index != StateIndex::Same)
        return index;

    buttonPrevious.update();
    buttonNext.update();

    return StateIndex::Same;
}

void StateMenu::checkIfElementPressed(m5::touch_detail_t clickDetails)
{
    if (buttonNext.isInsideArea(clickDetails.x, clickDetails.y))
    {
        // if button pressed
        if (buttonNext.pressButton())
        {
            // TODO do action
            index = StateIndex::PopupYesNo;
        }
    }
    else if (buttonPrevious.isInsideArea(clickDetails.x, clickDetails.y))
    {
        if (buttonPrevious.pressButton())
        {
            // TODO do action
        }
    }
}

///////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////// State App /////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////

StateApp::StateApp()
{
}
